# Тестирование отправки сообщений в Kafka через API

## Описание

Скрипт `test_kafka_send.sh` позволяет тестировать отправку сообщений в Kafka топик через HTTP API с использованием curl.

## Запуск Kafka Gateway

Перед использованием скрипта убедитесь, что Kafka Gateway запущен:

```bash
go run cmd/kafkaGateway/main.go
```

По умолчанию сервер запускается на порту 8080.

## Использование скрипта

### Базовое использование

```bash
./test_kafka_send.sh
```

Отправит тестовое сообщение в топик `test-topic`.

### Параметры командной строки

- `-u, --url URL` - URL API (по умолчанию: `http://localhost:8080`)
- `-t, --topic TOPIC` - Название топика (по умолчанию: `test-topic`)
- `-k, --api-key KEY` - API ключ для аутентификации
- `-h, --help` - Показать справку

### Примеры

```bash
# Отправить сообщение в другой топик
./test_kafka_send.sh -t my-custom-topic

# Отправить сообщение с указанием API ключа
./test_kafka_send.sh -t test-topic -k "your-api-key"

# Отправить сообщение на другой URL
./test_kafka_send.sh -u http://localhost:9090 -t test-topic

# Полный пример с параметрами
./test_kafka_send.sh -u http://localhost:8080 -t my-topic -k "default-api-key"
```

## Функциональность скрипта

Скрипт выполняет следующие тесты:

1. **Проверка доступности API** - проверяет, доступен ли сервер по заданному URL
2. **Отправка простого сообщения** - отправляет JSON сообщение с ключом и значением
3. **Отправка сообщения с заголовками** - отправляет сообщение с дополнительными заголовками
4. **Проверка валидации топика** - пытается отправить сообщение в неверный топик (начинающийся с точки)

## Требования

- bash
- curl
- jq (для форматирования JSON, опционально)

## Пример вывода

```
=== Тестирование отправки сообщения в Kafka топик ===
API URL: http://localhost:8080
Топик: test-topic

Проверка доступности API...
✓ API доступен

Тест 1: Отправка простого сообщения
Отправляем сообщение:
{
  "topic": "test-topic",
  "key": "test-key-1731487234",
  "value": {
    "message": "Hello from curl test!",
    "timestamp": "2025-11-13T09:33:54Z",
    "test_id": "test-1731487234-12345"
  }
}

✓ Сообщение успешно отправлено
Ответ сервера:
{
  "success": true,
  "message": "Message sent to Kafka successfully",
  "timestamp": "2025-11-13T09:33:54.123456Z"
}
```

## Конфигурация

Сервер использует следующие переменные окружения (или .env файл):

- `KAFKA_BROKERS` - адрес Kafka брокера (по умолчанию: `localhost:9092`)
- `SERVER_PORT` - порт сервера (по умолчанию: `8080`)
- `API_KEYS` - API ключи для аутентификации (по умолчанию: `default-api-key`)

## Запуск с Docker (если используется)

Если вы используете Kafka в Docker, убедитесь, что она доступна по адресу, указанному в конфигурации.

## Примечание об аутентификации

По умолчанию скрипт использует API ключ `default-api-key`, который задан в файле `.env`.
Если вы измените значение `API_KEYS` в файле `.env`, убедитесь, что используете правильный ключ при запуске скрипта.